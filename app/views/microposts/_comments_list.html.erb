<% @comments = micropost.comments %>
<% @numberComments = @comments.length %>
<% if @numberComments > 4 %>
	<div class="toggle-comments-list">view all <%= @numberComments %> comments</div>
	<% @comments.each_with_index do |comment, index| %>
		<% if index < @numberComments - 4 %>
			<div class="comment" id="comment-<%= comment.id %>" style="display: none;">
			<% @user = User.find_by(id: comment.user_id) %>
			<div class="user-name">
				<%= link_to @user.name, @user %>
			</div>
			<div class="comment-content"><%= comment.content %></div>
				<% if current_user == @user || current_user == micropost.user %>
					<div class="setting">
						<div class="dropdown">
							<a href="#" class="dropdown-toggle" data-toggle="dropdown">
								<b class="glyphicon glyphicon-remove"></b>
							</a>
							<ul class="dropdown-menu">
								<li><%= link_to "Delete comment", comment_path(id: comment.id), method: :delete, remote: true %></li>
							</ul>
						</div>
					</div>
				<% end %>
			</div>
		<% else %>
			<%= render 'microposts/comment', comment: comment, micropost: micropost %>
		<% end %>
	<% end %>
<% else %>
	<% @comments.each do |comment| %>
		<%= render 'microposts/comment', comment: comment, micropost: micropost %>
	<% end %>
<% end %>

<script type="text/javascript">
	$(document).on("click", "div.toggle-comments-list", function(e){
		$(this).parent().find(".comment").fadeIn();
		$(this).fadeOut();
	});
</script>