<li class="micropost" id="micropost-<%= micropost.id %>">
	<div class="head">
		<div class="avatar">
			<% if micropost.user.avatar? %>
				<%= link_to image_tag(micropost.user.avatar.url), micropost.user %>
			<% else %>
				<% if micropost.user.gender == "Male" %>
					<%= link_to image_tag(micropost.user.avatar.default_url("ava-default-male.jpg")), micropost.user %>
				<% else %>
					<%= link_to image_tag(micropost.user.avatar.default_url("ava-default-female.png")), micropost.user %>
				<% end %>
			<% end %>
		</div>
		<div class="user-name">
			<%= link_to micropost.user.name, micropost.user %>			
		</div>
		<div class="timestamp">
			<%= time_ago_in_words(micropost.created_at) %>
		</div>
		<% if current_user == micropost.user %>
			<div class="setting">
				<div class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown">
						<b class="caret"></b>
					</a>
					<ul class="dropdown-menu">
						<li><%= link_to "Delete", micropost, method: :delete %></li>
					</ul>
				</div>
			</div>
		<% end %>
	</div>
	<div class="content">
		<div class="image-content">
			<%= image_tag micropost.picture.url if micropost.picture? %>
		</div>
		<div class="number-like" id="number-like-<%= micropost.id %>"><%= micropost.likes.count %> likes</div>
		<div class="text-content">
			<% if micropost.content.length != 0%>
				<%= link_to micropost.user.name, micropost.user %> 
				<%= micropost.content %>
			<% end %>
		</div>
	</div>
	<div class="comment-section">
		<div class="comments-list">
			<% @comments = micropost.comments %>
			<% @numberComments = @comments.length %>
			<% if @numberComments > 4 %>
				<div class="toggle-comments-list">view all <%= @numberComments %> comments</div>
				<% @comments.each_with_index do |comment, index| %>
					<% if index < @numberComments - 4 %>
						<div class="comment" id="comment-<%= comment.id %>" style="display: none;">
							<% @user = User.find_by(id: comment.user_id) %>
							<div class="user-name">
								<%= link_to @user.name, @user %>
							</div>
							<div class="comment-content"><%= comment.content %></div>
							<% if current_user == @user || current_user == micropost.user %>
								<div class="setting">
									<div class="dropdown">
										<a href="#" class="dropdown-toggle" data-toggle="dropdown">
											<b class="glyphicon glyphicon-remove"></b>
										</a>
										<ul class="dropdown-menu">
											<li><%= link_to "Delete comment", comment_path(id: comment.id), method: :delete, remote: true %></li>
										</ul>
									</div>
								</div>
							<% end %>
						</div>
					<% else %>
						<%= render 'microposts/comment', comment: comment, micropost: micropost %>
					<% end %>
				<% end %>
			<% else %>
				<% @comments.each do |comment| %>
					<%= render 'microposts/comment', comment: comment, micropost: micropost %>
				<% end %>
			<% end %>
		</div>
		<div class="comment-form">
			<% if current_user.already_like?(micropost) %>
				<% @like = Like.where("user_id = ? and micropost_id = ?", current_user.id, micropost.id).first %>
				<div id="micropost-like-<%= micropost.id %>">
					<%= link_to like_path(id: @like.id), method: :delete, remote: true do %>
						<%= fa_icon "heart" %>
					<% end %>
				</div>
			<% else %>
				<div id="micropost-like-<%= micropost.id %>">
					<%= link_to likes_path(micropost_id: micropost.id), method: :post, remote: true do %>
						<%= fa_icon "heart-o" %>
					<% end %>
				</div>
			<% end %>
			<%= form_tag comments_path(micropost_id: micropost.id), remote: true do %>
				<%= text_field_tag :content, nil, placeholder: "Add a comment..." %>
			<% end %>
		</div>
	</div>
</li>
<script type="text/javascript">
	$("div.toggle-comments-list").on("click", function(e){
		$(this).parent().find(".comment").fadeIn();
		$(this).fadeOut();
	});
</script>